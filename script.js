const translations = {
    ru: {
        page_title_main: "Портфолио",
        hero_main_title: "TATTOOKIRILL YUVELIR",
        nav_about: "Обо мне",
        nav_services: "Услуги",
        nav_portfolio: "Работы",
        nav_portfolio_videos: "Видео",
        nav_process: "Процесс",
        nav_contact: "Контакты",
        hero_subtitle: "Tattoo Germany",
        hero_description_short: "Ваш мастер эксклюзивных татуировок",
        hero_description: "Ваш мастер эксклюзивных татуировок.",
        hero_contact_btn: "Связаться",
        about_title: "Обо мне",
        about_description_new: "Привет! Меня зовут Кирилл, я тату-мастер, и свой путь в этой профессии начал довольно рано — в 16 лет. Всё началось с моей первой татуировки, которую я сделал без разрешения родителей. Этот опыт перевернул моё восприятие: я понял, что татуировка — это не просто рисунок на теле, а настоящее искусство и способ самовыражения.",
        about_description_new_part2: "После этого я решил пойти на обучение и погрузился в мир татуировок всерьёз. С тех пор моя жизнь неразрывно связана с этой профессией. Я постоянно развиваюсь, пробую новые стили и техники, чтобы каждое моё тату было не просто работой, а уникальной историей, оставленной на теле человека.",
        services_title: "Услуги",
        service_realism_title: "Реализм",
        service_realism_description: "Передача изображения с фотографической точностью, детализация и объём.",
        service_japanese_title: "Японский стиль",
        service_japanese_description: "Традиционные мотивы: драконы, карпы, самураи. Яркие цвета и глубокий символизм.",
        service_chicano_title: "Чикано",
        service_chicano_description: "Культура латиноамериканских банд: клоунессы, пистолеты, розы. Смелые линии и тени.",
        service_ornamental_title: "Орнаментал/Графика",
        service_ornamental_description: "Узоры, геометрия, мандалы. Чистые линии и абстрактные формы.",
        service_mini_title: "Мини-тату",
        service_mini_description: "Маленькие и изящные татуировки. Идеально для первого опыта или деликатных зон.",
        portfolio_title: "Мои работы",
        portfolio_videos_title: "Видео работ",
        process_title: "Процесс создания татуировки",
        process_step1_title: "1. Консультация",
        process_step1_description: "Обсуждение идеи, стиля и размера татуировки, выбор места нанесения.",
        process_step2_title: "2. Разработка эскиза",
        process_step2_description: "Создание уникального эскиза, учитывая все пожелания клиента.",
        process_step3_title: "3. Подготовка к сеансу",
        process_step3_description: "Подготовка рабочего места и кожи клиента, обеспечение стерильности.",
        process_step4_title: "4. Нанесение татуировки",
        process_step4_description: "Аккуратное и точное выполнение работы профессиональным мастером.",
        process_step5_title: "5. Уход и заживление",
        process_step5_description: "Рекомендации по уходу за новой татуировкой для быстрого и правильного заживления.",
        contact_title: "Свяжитесь со мной",
        contact_description: "Готов воплотить ваши идеи в жизнь! Для записи на консультацию или сеанс, свяжитесь со мной любым удобным способом."
    },
    en: {
        page_title_main: "Portfolio",
        hero_main_title: "TATTOOKIRILL YUVELIR",
        nav_about: "About",
        nav_services: "Services",
        nav_portfolio: "Works",
        nav_portfolio_videos: "Videos",
        nav_process: "Process",
        nav_contact: "Contact",
        hero_subtitle: "Tattoo Germany",
        hero_description_short: "Your master of exclusive tattoos",
        hero_description: "Your master of exclusive tattoos.",
        hero_contact_btn: "Contact Me",
        about_title: "About Me",
        about_description_new: "Hi! My name is Kirill, I'm a tattoo artist, and I started my journey in this profession quite early — at 16 years old. It all began with my first tattoo, which I got without my parents' permission. This experience completely changed my perception: I realized that a tattoo isn't just a drawing on the body, but a true art form and a way of self-expression.",
        about_description_new_part2: "After that, I decided to pursue training and immersed myself seriously in the world of tattoos. Since then, my life has been inextricably linked with this profession. I'm constantly developing, trying new styles and techniques so that each of my tattoos is not just a job, but a unique story left on a person's body.",
        services_title: "Services",
        service_realism_title: "Realism",
        service_realism_description: "Achieving photographic accuracy, detail, and volume in tattoos.",
        service_japanese_title: "Japanese Style",
        service_japanese_description: "Traditional motifs: dragons, koi fish, samurai. Vibrant colors and deep symbolism.",
        service_chicano_title: "Chicano",
        service_chicano_description: "Latin American gang culture: clownesses, pistols, roses. Bold lines and shading.",
        service_ornamental_title: "Ornamental/Graphic",
        service_ornamental_description: "Patterns, geometry, mandalas. Clean lines and abstract forms.",
        service_mini_title: "Mini-Tattoo",
        service_mini_description: "Small and delicate tattoos. Ideal for first-timers or subtle placements.",
        portfolio_title: "My Works",
        portfolio_videos_title: "My Videos",
        process_title: "Tattoo Creation Process",
        process_step1_title: "1. Consultation",
        process_step1_description: "Discussing the idea, style, and size of the tattoo, choosing the placement.",
        process_step2_title: "2. Sketch Development",
        process_step2_description: "Creating a unique sketch, considering all client wishes.",
        process_step3_title: "3. Session Preparation",
        process_step3_description: "Preparing the workspace and client's skin, ensuring sterility.",
        process_step4_title: "4. Tattoo Application",
        process_step4_description: "Careful and precise execution of the work by a professional artist.",
        process_step5_title: "5. Aftercare and Healing",
        process_step5_description: "Recommendations for new tattoo care for fast and proper healing.",
        contact_title: "Contact Me",
        contact_description: "Ready to bring your ideas to life! To book a consultation or session, contact me using any convenient method."
    },
    de: {
        page_title_main: "Portfolio",
        hero_main_title: "TATTOOKIRILL YUVELIR",
        nav_about: "Über mich",
        nav_services: "Dienstleistungen",
        nav_portfolio: "Arbeiten",
        nav_portfolio_videos: "Videos",
        nav_process: "Prozess",
        nav_contact: "Kontakt",
        hero_subtitle: "Tattoo Deutschland",
        hero_description_short: "Ihr Meister für exklusive Tattoos",
        hero_description: "Ihr Meister für exklusive Tattoos.",
        hero_contact_btn: "Kontaktieren Sie mich",
        about_title: "Über mich",
        about_description_new: "Hallo! Mein Name ist Kirill, ich bin Tätowierer и habe meinen Weg in diesem Beruf ziemlich früh begonnen – с 16 Jahren. Alles begann mit meinem ersten Tattoo, das ich mir ohne die Erlaubnis meiner Eltern stechen ließ. Diese Erfahrung hat meine Wahrnehmung komplett verändert: Ich erkannte, dass ein Tattoo nicht nur eine Zeichnung auf dem Körper ist, sondern eine wahre Kunstform и eine Möglichkeit zur Selbstdarstellung.",
        about_description_new_part2: "Danach beschloss ich, eine Ausbildung zu machen и tauchte ernsthaft in die Welt der Tattoos ein. Seitdem ist mein Leben untrennbar mit diesem Beruf verbunden. Ich entwickle mich ständig weiter, probiere neue Stile und Techniken aus, damit jedes meiner Tattoos nicht nur eine Arbeit, sondern eine einzigartige Geschichte ist, die auf dem Körper eines Menschen hinterlassen wird.",
        services_title: "Dienstleistungen",
        service_realism_title: "Realismus",
        service_realism_description: "Übertragung von Bildern mit fotografischer Präzision, Detailgenauigkeit und Volumen.",
        service_japanese_title: "Japanischer Stil",
        service_japanese_description: "Traditionelle Motive: Drachen, Koi-Karpfen, Samurai. Lebendige Farben und tiefe Symbolik.",
        service_chicano_title: "Chicano",
        service_chicano_description: "Kultur lateinamerikanischer Banden: Clownfrauen, Pistolen, Rosen. Kühne Linien und Schatten.",
        service_ornamental_title: "Ornamental/Grafik",
        service_ornamental_description: "Muster, Geometrie, Mandalas. Klare Linien und abstrakte Formen.",
        service_mini_title: "Mini-Tattoo",
        service_mini_description: "Kleine und zierliche Tattoos. Ideal für erste Erfahrungen или diskrete Stellen.",
        portfolio_title: "Meine Arbeiten",
        portfolio_videos_title: "Meine Videos",
        process_title: "Tattoo-Erstellungsprozess",
        process_step1_title: "1. Beratung",
        process_step1_description: "Besprechung der Idee, des Stils и der Größe des Tattoos, Auswahl der Platzierung.",
        process_step2_title: "2. Skizzenentwicklung",
        process_step2_description: "Erstellung einer einzigartigen Skizze unter Berücksichtigung aller Kundenwünsche.",
        process_step3_title: "3. Vorbereitung auf die Sitzung",
        process_step3_description: "Vorbereitung des Arbeitsplatzes und der Haut des Kunden, Sicherstellung der Sterilität.",
        process_step4_title: "4. Tattoo-Anwendung",
        process_step4_description: "Sorgfältige und präzise Ausführung der Arbeit durch einen professionellen Künstler.",
        process_step5_title: "5. Pflege und Heilung",
        process_step5_description: "Empfehlungen zur Pflege des neuen Tattoos für eine schnelle und korrekte Heilung.",
        contact_title: "Kontaktieren Sie mich",
        contact_description: "Bereit, Ihre Ideen zum Leben zu erwecken! Um einen Beratungstermin или eine Sitzung zu buchen, kontaktieren Sie mich auf jede bequeme Weise."
    },
    ua: {
        page_title_main: "Портфоліо",
        hero_main_title: "TATTOOKIRILL YUVELIR",
        nav_about: "Про мене",
        nav_services: "Послуги",
        nav_portfolio: "Роботи",
        nav_portfolio_videos: "Відео",
        nav_process: "Процес",
        nav_contact: "Контакти",
        hero_subtitle: "Tattoo Germany",
        hero_description_short: "Ваш майстер ексклюзивних татуювань",
        hero_description: "Ваш майстер ексклюзивних татуювань.",
        hero_contact_btn: "Зв'язатися",
        about_title: "Про мене",
        about_description_new: "Привіт! Мене звати Кирило, я тату-майстер, і свій шлях у цій професії я розпочав досить рано — у 16 років. Усе почалося з мого першого татуювання, яке я зробив без дозволу батьків. Цей досвід повністю змінив моє сприйняття: я зрозумів, що татуювання — це не просто малюнок на тілі, а справжнє мистецтво і спосіб самовираження.",
        about_description_new_part2: "Після цього я вирішив піти на навчання і серйозно занурився у світ татуювань. Відтоді моє життя нерозривно пов'язане з цією професією. Я постійно розвиваюся, пробую нові стилі та техніки, щоб кожне моє тату було не просто роботою, а унікальною історією, залишеною на тілі людини.",
        services_title: "Послуги",
        service_realism_title: "Реалізм",
        service_realism_description: "Передача зображення з фотографічною точністю, деталізація та об'єм.",
        service_japanese_title: "Японський стиль",
        service_japanese_description: "Традиційні мотиви: дракони, коропи, самураї. Яскраві кольори та глибокий символізм.",
        service_chicano_title: "Чікано",
        service_chicano_description: "Культура латиноамериканських банд: клоунеси, пістолети, троянди. Сміливі лінії та тіні.",
        service_ornamental_title: "Орнаментал/Графіка",
        service_ornamental_description: "Візерунки, геометрія, мандали. Чисті лінії та абстрактні форми.",
        service_mini_title: "Міні-тату",
        service_mini_description: "Маленькі та витончені татуювання. Ідеально для першого досвіду або делікатних зон.",
        portfolio_title: "Мої роботи",
        portfolio_videos_title: "Відео робіт",
        process_title: "Процес створення татуювання",
        process_step1_title: "1. Консультація",
        process_step1_description: "Обговорення ідеї, стилю та розміру татуювання, вибір місця нанесення.",
        process_step2_title: "2. Розробка ескізу",
        process_step2_description: "Створення унікального ескізу, враховуючи всі побажання клієнта.",
        process_step3_title: "3. Підготовка до сеансу",
        process_step3_description: "Підготовка робочого місця та шкіри клієнта, забезпечення стерильності.",
        process_step4_title: "4. Нанесення татуювання",
        process_step4_description: "Акуратне та точне виконання роботи професійним майстром.",
        process_step5_title: "5. Догляд та загоєння",
        process_step5_description: "Рекомендації щодо догляду за новим татуюванням для швидкого та правильного загоєння.",
        contact_title: "Зв'яжіться зі мною",
        contact_description: "Готовий втілити ваші ідеи в життя! Для записи на консультацию или сеанс, свяжитесь со мной любым удобным способом."
    }
};

function applyTranslations(lang) {
    document.querySelectorAll('[data-lang-key]').forEach(element => {
        const key = element.getAttribute('data-lang-key');
        if (translations[lang] && translations[lang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.setAttribute('placeholder', translations[lang][key]);
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });
    const currentLangSpan = document.querySelector('.current-lang');
    if (currentLangSpan) {
        currentLangSpan.textContent = lang.toUpperCase();
    }
}

let lightbox;
let lightboxImg;
let closeBtn;
let prevBtn;
let nextBtn;
let galleryImages = [];

document.addEventListener('DOMContentLoaded', () => {
    // Весь код, вызывающий reflow/layout, обернут в setTimeout
    setTimeout(() => {
        AOS.init({
            duration: 1000,
            once: true,
        });

        // Инициализация Swiper carousels
        new Swiper('.services-carousel', {
            effect: 'coverflow',
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            coverflowEffect: {
                rotate: 50,
                stretch: 0,
                depth: 100,
                modifier: 1,
                slideShadows: true,
            },
            loop: true,
            loopedSlides: 5, 
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            autoplay: {
                delay: 3500,
                disableOnInteraction: false,
            },
            breakpoints: {
                320: {
                    slidesPerView: 1,
                    coverflowEffect: {
                        depth: 50,
                    },
                },
                640: {
                    slidesPerView: 2,
                    spaceBetween: 20,
                },
                1024: {
                    slidesPerView: 3,
                    spaceBetween: 30,
                },
            },
        });

        new Swiper('.portfolio-carousel', {
            effect: 'coverflow',
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            coverflowEffect: {
                rotate: 50,
                stretch: 0,
                depth: 100,
                modifier: 1,
                slideShadows: true,
            },
            loop: true,
            loopedSlides: 10,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            autoplay: {
                delay: 3000,
                disableOnInteraction: false,
            },
            breakpoints: {
                320: {
                    slidesPerView: 1,
                    coverflowEffect: {
                        depth: 50,
                    },
                },
                640: {
                    slidesPerView: 2,
                    spaceBetween: 20,
                },
                1024: {
                    slidesPerView: 3,
                    spaceBetween: 30,
                },
            },
        });

        new Swiper('.process-carousel', {
            effect: 'coverflow',
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            coverflowEffect: {
                rotate: 50,
                stretch: 0,
                depth: 100,
                modifier: 1,
                slideShadows: true,
            },
            loop: true,
            loopedSlides: 5,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            autoplay: {
                delay: 4000,
                disableOnInteraction: false,
            },
            breakpoints: {
                320: {
                    slidesPerView: 1,
                    coverflowEffect: {
                        depth: 50,
                    },
                },
                640: {
                    slidesPerView: 2,
                    spaceBetween: 20,
                },
                1024: {
                    slidesPerView: 3,
                    spaceBetween: 30,
                },
            },
        });

        // Lightbox functionality оставим здесь, так как он должен быть готов после Swiper
        lightbox = document.getElementById('lightbox');
        lightboxImg = document.getElementById('lightbox-img');
        closeBtn = document.querySelector('.lightbox-close');
        prevBtn = document.querySelector('.lightbox-prev');
        nextBtn = document.querySelector('.lightbox-next');
        
        galleryImages = Array.from(document.querySelectorAll('.portfolio-carousel .swiper-slide img')); 

        galleryImages.forEach((img, index) => {
            img.addEventListener('click', () => {
                currentImageIndex = index;
                showImage(currentImageIndex);
            });
        });

        closeBtn.addEventListener('click', closeLightbox);
        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) {
                closeLightbox();
            }
        });

        prevBtn.addEventListener('click', showPrevImage);
        nextBtn.addEventListener('click', showNextImage);

        document.addEventListener('keydown', (e) => {
            if (lightbox.classList.contains('active')) {
                if (e.key === 'ArrowLeft') {
                    showPrevImage();
                } else if (e.key === 'ArrowRight') {
                    showNextImage();
                } else if (e.key === 'Escape') {
                    closeLightbox();
                }
            }
        });

    }, 50);
    
    // Остальной код DOMContentLoaded, который не вызывает reflow, можно оставить снаружи setTimeout
    // Language Dropdown functionality
    const langDropdown = document.querySelector('.language-dropdown');
    const langDropdownToggle = document.querySelector('.lang-dropdown-toggle');
    const langOptions = document.querySelectorAll('.lang-option');

    langDropdownToggle.addEventListener('click', () => {
        langDropdown.classList.toggle('open');
    });

    langOptions.forEach(option => {
        option.addEventListener('click', () => {
            const lang = option.dataset.lang;
            localStorage.setItem('selectedLang', lang);
            applyTranslations(lang);
            langDropdown.classList.remove('open');
        });
    });

    document.addEventListener('click', (event) => {
        if (!langDropdown.contains(event.target)) {
            langDropdown.classList.remove('open');
        }
    });

    const savedLang = localStorage.getItem('selectedLang') || 'ru';
    applyTranslations(savedLang);

    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();

            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });

            const mainNav = document.querySelector('.main-nav');
            const hamburger = document.querySelector('.hamburger');
            if (mainNav.classList.contains('active')) {
                mainNav.classList.remove('active');
                hamburger.classList.remove('active');
                document.body.classList.remove('no-scroll');
            }
        });
    });

    // Scroll to top/bottom buttons
    const scrollToTopBtn = document.getElementById('scrollToTopBtn');
    const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');

    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
            scrollToTopBtn.style.display = 'flex';
        } else {
            scrollToTopBtn.style.display = 'none';
        }
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 50) {
            scrollToBottomBtn.style.display = 'none';
        } else {
            scrollToBottomBtn.style.display = 'flex';
        }
    });

    scrollToTopBtn.addEventListener('click', () => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    scrollToBottomBtn.addEventListener('click', () => {
        window.scrollTo({
            top: document.body.scrollHeight,
            behavior: 'smooth'
        });
    });

    // Hamburger menu functionality
    const hamburger = document.querySelector('.hamburger');
    const mainNav = document.querySelector('.main-nav');

    hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        mainNav.classList.toggle('active');
        document.body.classList.toggle('no-scroll');
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
        if (!mainNav.contains(e.target) && !hamburger.contains(e.target) && !langDropdown.contains(e.target) && mainNav.classList.contains('active')) {
            mainNav.classList.remove('active');
            hamburger.classList.remove('active');
            document.body.classList.remove('no-scroll');
        }
    });

});

function showImage(index) {
    if (galleryImages.length > 0) {
        lightboxImg.src = galleryImages[index].src;
        lightbox.classList.add('active');
        document.body.classList.add('no-scroll');
    }
}

function closeLightbox() {
    lightbox.classList.remove('active');
    lightboxImg.src = '';
    document.body.classList.remove('no-scroll');
}

function showPrevImage() {
    currentImageIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
    showImage(currentImageIndex);
}

function showNextImage() {
    currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
    showImage(currentImageIndex);
}